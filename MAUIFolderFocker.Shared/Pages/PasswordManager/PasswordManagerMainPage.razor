@using System.Security
@inject IJSRuntime JS

@page "/passwordmanager_mainpage"

<h3>PasswordManagerMainPage</h3>

<style>
/* simple, modern layout inspired by password managers */
:root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#7c3aed}
body,html{height:100%;margin:0;font-family:Inter,Segoe UI,SegoeUI,Helvetica,Arial}
.page{display:grid;grid-template-columns:260px 1fr 360px;gap:18px;padding:18px;background:linear-gradient(180deg,#071129 0%, #081022 100%);min-height:100vh;color:#e6eef8}
.sidebar{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:14px}
.logo{font-weight:700;font-size:18px;display:flex;align-items:center;gap:8px}
.search{margin:12px 0}
.input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.folder{padding:8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;margin:6px 0;cursor:pointer}
.folder:hover{background:rgba(255,255,255,0.02)}
.center{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:12px;padding:14px}
.toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.card{background:var(--card);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:8px}
.card .meta{display:flex;justify-content:space-between;align-items:center}
.small{font-size:12px;color:var(--muted)}
.actions{display:flex;gap:8px}
.btn{padding:8px 10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),#4f46e5);color:white}
.detail{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:12px;padding:14px}
.field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
.input-plain{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.copy{display:flex;gap:8px;align-items:center}
.empty{opacity:0.5;text-align:center;padding:28px}
</style>

<div class="page">
    <aside class="sidebar">
        <div class="logo">🔐 PassVault</div>
        <div class="search">
            <input class="input" placeholder="Szukaj..." @bind="Search" />
        </div>

@code{

        <div class="grid">
            @if(!FilteredEntries.Any()){
                <div class="card empty">Brak pozycji — użyj "Dodaj pozycję" aby rozpocząć</div>
            } else {
                @foreach(var item in FilteredEntries)
                {
                    <div class="card" @onclick="() => ShowDetail(item)">
                        <div class="meta">
                            <div style="font-weight:600">@item.Title</div>
                            <div class="small">@item.Modified.ToString("yyyy-MM-dd")</div>
                        </div>
                        <div class="small">@item.Username</div>
                        <div class="small">@item.Url</div>
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <div class="small">@item.Note?.Substring(0, Math.Min(60, item.Note?.Length ?? 0))</div>
                            <div class="actions">
                                @* <button class="btn" @onclick:stopPropagation="true" @onclick="() => CopyPassword(item)">Kopiuj</button> *@
                                <button class="btn" @onclick:stopPropagation="true" @onclick="() => RevealToggle(item)">@(item.Revealed?"Ukryj":"Pokaż")</button>
                            </div>
                        </div>
                        @if(item.Revealed){
                            <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
                                <div class="small">Hasło: <strong>@item.Password</strong></div>
                                <div class="small">Siła: @GetStrength(item.Password)</div>
                            </div>
                        }
                    </div>
                }
            }
        </div>
    </main>

    <aside class="detail">
        @if (SelectedItem == null)
        {
            <div class="empty">Wybierz pozycję aby zobaczyć szczegóły</div>
        }
        else
        {
            <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:700">@SelectedItem.Title</div>
                <div class="small">@SelectedItem.Modified.ToString("g")</div>
            </div>

            <div class="field">
                <label class="small">Nazwa użytkownika</label>
                <input class="input-plain" value="@SelectedItem.Username" />
            </div>

            <div class="field">
                <label class="small">Hasło</label>
                <div style="display:flex;gap:8px;align-items:center">
                    <input class="input-plain" value="@(SelectedItem.Revealed? SelectedItem.Password : new string ('•', Math.Max(8, SelectedItem.Password?.Length ?? 8)))" readonly />
                    <div class="copy">
                        <button class="btn" @onclick="ToggleReveal">@(SelectedItem.Revealed? "Ukryj" : "Pokaż")</button>
                        <button class="btn">Kopiuj</button>
                    </div>
                </div>
            </div>

            <div class="field">
                <label class="small">URL</label>
                <input class="input-plain" value="@SelectedItem.Url" />
            </div>

            <div class="field">
                <label class="small">Notatka</label>
                <textarea class="input-plain" rows="4">@SelectedItem.Note</textarea>
            </div>

            <div style="display:flex;gap:8px;justify-content:flex-end">
                <button class="btn">Usuń</button>
                <button class="btn primary">Zapisz</button>
            </div>
        }
        }}
    </aside>
    }
    }
</div>
@code{
}